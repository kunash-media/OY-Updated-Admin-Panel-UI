<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coupon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    
    <style>

        body {
            margin: 0;
            padding: 0;
            width: 100%;
            font-family: Arial, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .navbar {
            background-color: #2d2d30;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            font-family: "roboto";
        }
        
        .navbar .dashboard {
            color: white;
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        
        .navbar .menu-icon {
            color: white;
            margin-left: 15px;
            cursor: pointer;
        }
        
        .navbar .icons {
            display: flex;
            align-items: center;
        }
        
        .icons>i {
            margin-right: 20px;
        }
        
        .profile-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .profile-menu {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            width: 150px;
            z-index: 1000;
        }
        
        .profile-menu a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: black;
        }
        
        .profile-menu a:hover {
            background: #f1f1f1;
        }
        
        .profile-icon {
            cursor: pointer;
            color: white;
            font-size: 1.2em;
        }
        
        .left-nav {
            width: 220px;
            background-color: #2d2d30;
            position: fixed;
            top: 50px;
            left: 0;
            height: calc(100vh - 50px);
            display: none;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 999;
            font-family: "Open Sans";
        }
        
        .left-nav .category {
            cursor: pointer;
            margin: 15px 0;
            color: rgb(255, 255, 255);
        }


        .left-nav .sub-category a div,
        .left-nav .category {
        color: rgb(255, 255, 255) !important;
        text-decoration: none !important;
        }

        .left-nav .sub-category a:hover div {
            color: rgb(255, 255, 255) !important;
            text-decoration: none !important;
        }

        .left-nav .sub-category a {
            text-decoration: none !important;
        }
        
        .sub-category {
            margin-left: 20px;
            display: none;
        }
        
        .logout-button {
            background-color: #005f73;
            color: #d3d3d3;
            border: none;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .logout-button:hover {
            background-color: #007bff;
        }
        
        .main-content {
            margin-left: 18%;
            padding: 70px 0px 0px 0px;
            transition: margin-left 0.3s;
            font-family: "Ancizar Serif ";

        }

        footer {
            background-color: #808080;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 30px;
            width: 100%;
            font-family: "Open Sans";
        }
        

        .left-nav a {
        color: inherit !important;
        text-decoration: none !important;
        }

        .left-nav a:hover {
        color: inherit !important;
        text-decoration: none !important;
        }

        .profile-icon {
        cursor: pointer;
        color: white;
        font-size: 1.7em; 
        }
        .table td.text-center {
    white-space: nowrap; /* Prevent buttons from wrapping */
}

.table td .btn-group {
    display: inline-flex; /* Use inline-flex instead of flex */
    gap: 5px;
}

.table td .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1.5;
    min-width: 32px; /* Set a minimum width for consistency */
}

/* Ensure the action cell doesn't grow too wide */
.table td:last-child {
    width: 1%;
    white-space: nowrap;
}
.main-content{
                font-family: "Ancizar Serif ";

}

    </style>
</head>

<body>
    <nav class="navbar">
        <div class="dashboard">
            <i class="fas fa-bars menu-icon" id="menuIcon"></i>
            <span style="margin-left: 10px; font-size: 20px;">Dashboard</span>
        </div>
        <div class="icons">
            <div class="profile-dropdown">
                <i class="fas fa-user-circle profile-icon" id="profileIcon"></i>
                <div class="profile-menu" id="profileMenu" style=" font-family: Open Sans;">
                    <!-- <a href="">Profile</a> -->
                    <a href="Login.html">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="left-nav" id="leftNav">
        <div class="category" id="catalog">Inventory<i class="fas fa-chevron-down" id="catalogToggle"></i></div>
        <div class="sub-category" id="catalogSub">
           <a href="Products.html"><div>Products</div></a> 
            <!-- <a href="Category.html"><div>Categories</div></a> -->
            <a href="Coupon.html"><div>Coupons</div></a>
        </div>
        <div class="category" id="customers">Customers <i class="fas fa-chevron-down" id="customersToggle"></i></div>
        <div class="sub-category" id="customersSub">
           <a href="CustomerDetails.html"><div>Customer Details</div></a> 
        </div>
       <a href="Orders.html"><div class="category" >Orders</div></a> 
        <div class="category" id="onlineStore">Online Store <i class="fas fa-chevron-down" id="onlineStoreToggle"></i></div>
        <div class="sub-category" id="onlineStoreSub" style="display: none;">
  <a href="https://jewelry-frontend-six.vercel.app/"><div>View Store</div></a>            <a href="StoreCustomization.html"><div>Store Customization</div></a>
            <!-- <a href="StoreSettings.html"><div>Store Settings</div></a> -->
        </div>
        <a href="OurStaff.html"><div class="category">Our Staff</div></a>
       <a href="Settings.html"><div class="category" id="settings">Settings</div></a> 
        <button class="logout-button" onclick="window.location.href='login.html'"> <i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>

    <div class="main-content">
        <h3 class="mb-4" style="font-size:21px; font-weight: 350; font-family:roboto; "><b>Coupon</b></h3>
    </div>

    <div class="button-container d-flex justify-content-between align-items-center" style="margin-left: 270px; margin-top: 20px; margin-bottom: 30px; padding: 25px; background-color: #f8f9fa; border-radius: 5px; margin-right: 40px;border:1px solid grey">
        <div class="left-buttons">
            <div class="btn-group me-2">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-file-export"></i> Export
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#"><i class="fas fa-file-excel"></i> Export by Excel</a></li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-file-csv"></i> Export by CSV</a></li>
                </ul>
            </div>
            <div class="btn-group">
                <button class="btn btn-outline-success" type="button" data-bs-toggle="collapse" data-bs-target="#importCollapse">
                    <i class="fas fa-file-import"></i> Import
                </button>
                <div id="importCollapse" class="collapse" style="position: absolute; z-index: 1000; width: 300px; margin-top: 5px;">
                    <div class="card card-body" style="border: 2px dashed #6c757d; padding: 20px;">
                        <input type="file" id="fileInput" style="display: none;" multiple>
                        <p class="text-center" onclick="document.getElementById('fileInput').click()" style="cursor: pointer;">Click to select files</p>
                        <button class="btn btn-primary ms-auto" style="width: fit-content;" onclick="handleImport()">
                            <i class="fas fa-upload"></i> Import Now
                        </button>
                    </div>
                </div>
                 <script>
                    function handleImport() {
                        const fileInput = document.getElementById('fileInput');
                        if (fileInput.files.length > 0) {
                            // Process selected files here
                            alert(`Importing ${fileInput.files.length} file(s)`);
                        } else {
                            alert('Please select files first');
                        }
                    }
                </script>
            </div>
        </div>
        <div class="right-buttons">
            <button class="btn btn-outline-danger me-2" id="deleteSelectedBtn">
                <i class="fas fa-trash"></i> Delete
            </button>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCouponModal">
                <i class="fas fa-plus"></i> Add Coupons
            </button>
        </div>
    </div>

    <div class="filter-container d-flex align-items-center" style="margin-left: 270px; margin-top: 20px; margin-bottom: 30px; padding: 25px; background-color: #f8f9fa; border-radius: 5px; margin-right: 40px; border:1px solid grey">
        <div class="search-box me-3" style="flex: 1;">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search coupons...">
                <button class="btn btn-outline-secondary" type="button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <div class="dropdown me-3">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="discountTypeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Discount Type
            </button>
            <ul class="dropdown-menu" aria-labelledby="discountTypeDropdown">
                <li><a class="dropdown-item" href="#">All Types</a></li>
                <li><a class="dropdown-item" href="#">Percentage</a></li>
                <li><a class="dropdown-item" href="#">Fixed Amount</a></li>
            </ul>
        </div>

        <div class="dropdown me-3">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="statusDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Status
            </button>
            <ul class="dropdown-menu" aria-labelledby="statusDropdown">
                <li><a class="dropdown-item" href="#">All Statuses</a></li>
                <li><a class="dropdown-item" href="#">Active</a></li>
                <li><a class="dropdown-item" href="#">Expired</a></li>
                <li><a class="dropdown-item" href="#">Upcoming</a></li>
            </ul>
        </div>

        <button class="btn btn-primary me-2" id="filterBtn">
            <i class="fas fa-filter"></i> Filter
        </button>

        <button class="btn btn-outline-danger" id="resetBtn">
            <i class="fas fa-undo"></i> Reset
        </button>
    </div>

    <div class="table-container" style="margin-left: 270px; margin-right: 40px;">
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="table-light">
                <tr>
                    <th style="width: 30px;"><input type="checkbox" id="selectAll"></th>
                    <th>Banner</th>
                    <th>Coupon Code</th>
                    <th>Coupon Name</th>
                    <th>Description</th>
                    <th>Discount Type</th>
                    <th>Status</th>
                    <th>Valid From</th>
                    <th>Valid Until</th>
                    <th>Discount Value</th>
                    <th style="width: 80px;">Actions</th>
                </tr>
            </thead>
            <tbody id="couponsTableBody">
                <!-- Coupons will be dynamically added here -->
            </tbody>
        </table>
    </div>
</div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteMessage">Are you sure you want to delete the selected items?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Coupon Modal -->
    <div class="modal fade" id="addCouponModal" tabindex="-1" aria-labelledby="addCouponModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCouponModalLabel">Add New Coupon</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="couponForm">
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="couponBanner" class="form-label">Coupon Banner Image</label>
                                <input type="file" class="form-control" id="couponBanner" accept="image/*" required>
                                <div class="form-text">Upload a banner image for the coupon (recommended size: 800x200px)</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="couponName" class="form-label">Coupon Name</label>
                                <input type="text" class="form-control" id="couponName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="couponCode" class="form-label">Coupon Code</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="couponCode" required>
                                    <button class="btn btn-outline-secondary" type="button" id="generateCodeBtn">
                                        <i class="fas fa-sync-alt"></i> Generate
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="validityStart" class="form-label">Valid From</label>
                                <input type="datetime-local" class="form-control" id="validityStart" required>
                            </div>
                            <div class="col-md-6">
                                <label for="validityEnd" class="form-label">Valid Until</label>
                                <input type="datetime-local" class="form-control" id="validityEnd" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="discountType" class="form-label">Discount Type</label>
                                <select class="form-select" id="discountType" required>
                                    <option value="percentage">Percentage</option>
                                    <option value="fixed">Fixed Amount</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="discountValue" class="form-label">Discount Value</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="discountValue" min="0" step="0.01" required>
                                    <span class="input-group-text" id="discountSuffix">%</span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="couponDescription" class="form-label">Description (Optional)</label>
                                <textarea class="form-control" id="couponDescription" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="addCouponBtn">Add Coupon</button>
                </div>
            </div>
        </div>
    </div>


    <footer style="background-color: #f0f0f0; height: 60px; display: flex; align-items: center; justify-content: center;font-family: Open Sans;">
        <!-- <img src="Img/logo.jpg" alt="Kunash Media Logo" style="height: 40px;  width:60px ;margin-right: 15px;"> -->
        <p style="color: black; font-weight: 400; margin: 0; font-size: medium;">© 2025 Kunash Media | Developed by Pranjal Prasad</p>
    </footer>

<script>

     // Save coupons to localStorage
        function saveCoupons(coupons) {
            localStorage.setItem('coupons', JSON.stringify(coupons));
        }

        // Load coupons from localStorage
        function loadCoupons() {
            const coupons = JSON.parse(localStorage.getItem('coupons')) || [];
            return coupons;
        }

        // Generate random coupon code
        function generateCouponCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Update discount suffix based on type
        document.getElementById('discountType').addEventListener('change', function() {
            const suffix = this.value === 'percentage' ? '%' : '$';
            document.getElementById('discountSuffix').textContent = suffix;
        });

        // Generate coupon code button
        document.getElementById('generateCodeBtn').addEventListener('click', function() {
            document.getElementById('couponCode').value = generateCouponCode();
        });

        // Add coupon to storage
        document.getElementById('addCouponBtn').addEventListener('click', function() {
            const bannerFile = document.getElementById('couponBanner').files[0];
            if (!bannerFile) {
                alert('Please upload a coupon banner image');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const coupons = loadCoupons();
                const newCoupon = {
                    id: Date.now().toString(),
                    banner: e.target.result,
                    name: document.getElementById('couponName').value,
                    code: document.getElementById('couponCode').value,
                    validFrom: document.getElementById('validityStart').value,
                    validUntil: document.getElementById('validityEnd').value,
                    discountType: document.getElementById('discountType').value,
                    discountValue: document.getElementById('discountValue').value,
                    description: document.getElementById('couponDescription').value,
                    createdAt: new Date().toISOString()
                };

                coupons.push(newCoupon);
                saveCoupons(coupons);

                // Close modal and reset form
                const modal = bootstrap.Modal.getInstance(document.getElementById('addCouponModal'));
                modal.hide();
                document.getElementById('couponForm').reset();
                document.getElementById('discountSuffix').textContent = '%';
            };
            reader.readAsDataURL(bannerFile);
        });

        // Initialize date inputs with current time
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const startDate = now.toISOString().slice(0, 16);
            const endDate = new Date(now.setMonth(now.getMonth() + 1)).toISOString().slice(0, 16);

            document.getElementById('validityStart').value = startDate;
            document.getElementById('validityEnd').value = endDate;
            document.getElementById('couponCode').value = generateCouponCode();
        });
   

 
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dropdown selections
            document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item:first-child, #statusDropdown + .dropdown-menu .dropdown-item:first-child')
                .forEach(item => item.classList.add('active'));

            document.getElementById('filterBtn').addEventListener('click', function() {
                const discountTypeElement = document.querySelector('#discountTypeDropdown + .dropdown-menu .active');
                const statusElement = document.querySelector('#statusDropdown + .dropdown-menu .active');
                const selectedDiscountType = discountTypeElement ? discountTypeElement.textContent : 'All Types';
                const selectedStatus = statusElement ? statusElement.textContent : 'All Statuses';

                const rows = document.querySelectorAll('.table tbody tr');

                rows.forEach(row => {
                    const rowDiscountType = row.cells[4].textContent;
                    const rowStatus = row.cells[5].textContent;

                    let discountTypeMatch = selectedDiscountType === 'All Types' || rowDiscountType.includes(selectedDiscountType);
                    let statusMatch = selectedStatus === 'All Statuses' || rowStatus.includes(selectedStatus);

                    row.style.display = (discountTypeMatch && statusMatch) ? '' : 'none';
                });
            });

            document.getElementById('resetBtn').addEventListener('click', function() {
                // Reset dropdown selections
                document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item, #statusDropdown + .dropdown-menu .dropdown-item')
                    .forEach(item => item.classList.remove('active'));
                document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item:first-child, #statusDropdown + .dropdown-menu .dropdown-item:first-child')
                    .forEach(item => item.classList.add('active'));

                // Show all rows again
                document.querySelectorAll('.table tbody tr').forEach(row => {
                    row.style.display = '';
                });
            });

            // Add click handlers for dropdown items
            document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item, #statusDropdown + .dropdown-menu .dropdown-item')
                .forEach(item => {
                    item.addEventListener('click', function() {
                        this.parentElement.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
        });
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize with sample data if localStorage is empty
        initializeSampleData();
        renderProducts();

        // Left nav toggle
        document.getElementById('menuIcon').addEventListener('click', function() {
            const leftNav = document.getElementById('leftNav');
            leftNav.style.display = leftNav.style.display === 'block' ? 'none' : 'block';
        });

        // Profile menu toggle
        document.getElementById('profileIcon').addEventListener('click', function(e) {
            e.stopPropagation();
            const menu = document.getElementById('profileMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });

        // Close profile menu when clicking outside
        document.addEventListener('click', function() {
            document.getElementById('profileMenu').style.display = 'none';
        });

        // Submenu toggles
        document.getElementById('onlineStoreToggle').addEventListener('click', function() {
            const sub = document.getElementById('onlineStoreSub');
            sub.style.display = sub.style.display === 'block' ? 'none' : 'block';
        });
        
        document.getElementById('catalogToggle').addEventListener('click', function() {
            const sub = document.getElementById('catalogSub');
            sub.style.display = sub.style.display === 'block' ? 'none' : 'block';
        });

        document.getElementById('customersToggle').addEventListener('click', function() {
            const sub = document.getElementById('customersSub');
            sub.style.display = sub.style.display === 'block' ? 'none' : 'block';
        });

    });

    function deleteRow(btn) {
            const row = btn.closest('tr');
            const couponId = row.cells[1].textContent;
            document.getElementById('deleteMessage').textContent = `Are you sure you want to delete coupon ${couponId}?`;

            const deleteModal = new bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal'));
            deleteModal.show();

            document.getElementById('confirmDeleteBtn').onclick = function() {
                const coupons = loadCoupons();
                const updatedCoupons = coupons.filter(c => c.id !== couponId);
                saveCoupons(updatedCoupons);
                deleteModal.hide();
            };
        }

        // Delete selected rows
        document.getElementById('deleteSelectedBtn').addEventListener('click', function() {
            const selectedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            if (selectedCheckboxes.length === 0) {
                alert('Please select at least one coupon to delete');
                return;
            }

            document.getElementById('deleteMessage').textContent =
                `Are you sure you want to delete ${selectedCheckboxes.length} selected coupon(s)?`;

            const deleteModal = new bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal'));
            deleteModal.show();

            document.getElementById('confirmDeleteBtn').onclick = function() {
                const couponIds = Array.from(selectedCheckboxes).map(checkbox => {
                    return checkbox.closest('tr').cells[1].textContent;
                });

                const coupons = loadCoupons();
                const updatedCoupons = coupons.filter(c => !couponIds.includes(c.id));
                saveCoupons(updatedCoupons);
                deleteModal.hide();
            };
        });

    // Function to render coupons in the table
    function renderCoupons() {
        const coupons = loadCoupons();
        const tableBody = document.getElementById('couponsTableBody');
        tableBody.innerHTML = '';

        if (coupons.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="10" class="text-center py-4">No coupons found. Click "Add Coupons" to create one.</td>
                </tr>
            `;
            return;
        }

        coupons.forEach(coupon => {
            // Determine status based on dates
            const now = new Date();
            const validFrom = new Date(coupon.validFrom);
            const validUntil = new Date(coupon.validUntil);
            
            let status = 'Active';
            let statusClass = 'badge bg-success';
            
            if (now < validFrom) {
                status = 'Upcoming';
                statusClass = 'badge bg-info';
            } else if (now > validUntil) {
                status = 'Expired';
                statusClass = 'badge bg-danger';
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="checkbox"></td>
                <td>${coupon.code}</td>
                <td>${coupon.name}</td>
                <td>${coupon.description || '-'}</td>
                <td>${coupon.discountType === 'percentage' ? 'Percentage' : 'Fixed Amount'}</td>
                <td><span class="${statusClass}">${status}</span></td>
                <td>${formatDate(coupon.validFrom)}</td>
                <td>${formatDate(coupon.validUntil)}</td>
                <td>${coupon.discountValue}${coupon.discountType === 'percentage' ? '%' : '$'}</td>
                <td class="text-center">
                    <button class="btn btn-sm btn-outline-primary me-1" title="Edit">
                    <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="deleteCoupon('${coupon.id}')">
                    <i class="fas fa-trash"></i>
                    </button>
                    </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Helper function to format date
    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        return new Date(dateString).toLocaleDateString('en-US', options);
    }

    // Function to delete a coupon
    function deleteCoupon(id) {
        if (confirm('Are you sure you want to delete this coupon?')) {
            const coupons = loadCoupons();
            const updatedCoupons = coupons.filter(c => c.id !== id);
            saveCoupons(updatedCoupons);
            renderCoupons();
        }
    }

    // Initialize sample data if empty
    function initializeSampleData() {
        if (loadCoupons().length === 0) {
            const sampleCoupons = [
                {
                    id: '1',
                    banner: '',
                    name: 'Summer Sale',
                    code: 'SUMMER20',
                    validFrom: new Date(Date.now() - 86400000).toISOString(),
                    validUntil: new Date(Date.now() + 86400000 * 30).toISOString(),
                    discountType: 'percentage',
                    discountValue: '20',
                    description: 'Summer season discount',
                    createdAt: new Date().toISOString()
                },
                {
                    id: '2',
                    banner: '',
                    name: 'New Year Special',
                    code: 'NEWYEAR50',
                    validFrom: new Date(Date.now() + 86400000 * 10).toISOString(),
                    validUntil: new Date(Date.now() + 86400000 * 40).toISOString(),
                    discountType: 'fixed',
                    discountValue: '50',
                    description: 'New Year special discount',
                    createdAt: new Date().toISOString()
                }
            ];
            saveCoupons(sampleCoupons);
        }
    }

    // Select all checkboxes
    document.getElementById('selectAll').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#couponsTableBody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });

    // Update the DOMContentLoaded event to include renderCoupons
    document.addEventListener('DOMContentLoaded', function() {
        initializeSampleData();
        renderCoupons();
        
        // ... (rest of your existing DOMContentLoaded code)
    });

    // Update the addCouponBtn event listener to render after adding
    document.getElementById('addCouponBtn').addEventListener('click', function() {
        const bannerFile = document.getElementById('couponBanner').files[0];
        if (!bannerFile) {
            alert('Please upload a coupon banner image');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const coupons = loadCoupons();
            const newCoupon = {
                id: Date.now().toString(),
                banner: e.target.result,
                name: document.getElementById('couponName').value,
                code: document.getElementById('couponCode').value,
                validFrom: document.getElementById('validityStart').value,
                validUntil: document.getElementById('validityEnd').value,
                discountType: document.getElementById('discountType').value,
                discountValue: document.getElementById('discountValue').value,
                description: document.getElementById('couponDescription').value,
                createdAt: new Date().toISOString()
            };

            coupons.push(newCoupon);
            saveCoupons(coupons);

            // Close modal, reset form, and refresh table
            const modal = bootstrap.Modal.getInstance(document.getElementById('addCouponModal'));
            modal.hide();
            document.getElementById('couponForm').reset();
            document.getElementById('discountSuffix').textContent = '%';
            renderCoupons();
        };
        reader.readAsDataURL(bannerFile);
    });

function renderCoupons() {
    const coupons = loadCoupons();
    const tableBody = document.getElementById('couponsTableBody');
    tableBody.innerHTML = '';

    if (coupons.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="10" class="text-center py-4">No coupons found. Click "Add Coupons" to create one.</td>
            </tr>
        `;
        return;
    }

    coupons.forEach(coupon => {
        // Determine status based on dates
        const now = new Date();
        const validFrom = new Date(coupon.validFrom);
        const validUntil = new Date(coupon.validUntil);
        
        let status = 'Active';
        let statusClass = 'badge bg-success';
        
        if (now < validFrom) {
            status = 'Upcoming';
            statusClass = 'badge bg-info';
        } else if (now > validUntil) {
            status = 'Expired';
            statusClass = 'badge bg-danger';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="checkbox"></td>
            <td>${coupon.code}</td>
            <td>${coupon.name}</td>
            <td>${coupon.description || '-'}</td>
            <td>${coupon.discountType === 'percentage' ? 'Percentage' : 'Fixed Amount'}</td>
            <td><span class="${statusClass}">${status}</span></td>
            <td>${formatDate(coupon.validFrom)}</td>
            <td>${formatDate(coupon.validUntil)}</td>
            <td>${coupon.discountValue}${coupon.discountType === 'percentage' ? '%' : '$'}</td>
            <td class="text-center">
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-primary" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="deleteCoupon('${coupon.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(row);
    });
}

// Add coupon to storage
document.getElementById('addCouponBtn').addEventListener('click', function() {
    const bannerFile = document.getElementById('couponBanner').files[0];
    if (!bannerFile) {
        alert('Please upload a coupon banner image');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        const coupons = loadCoupons();
        const newCoupon = {
            id: Date.now().toString(),
            banner: e.target.result,
            name: document.getElementById('couponName').value,
            code: document.getElementById('couponCode').value,
            validFrom: document.getElementById('validityStart').value,
            validUntil: document.getElementById('validityEnd').value,
            discountType: document.getElementById('discountType').value,
            discountValue: document.getElementById('discountValue').value,
            description: document.getElementById('couponDescription').value,
            createdAt: new Date().toISOString()
        };

        coupons.push(newCoupon);
        saveCoupons(coupons);
        renderCoupons(); // Add this line to refresh the table

        // Close modal and reset form
        const modal = bootstrap.Modal.getInstance(document.getElementById('addCouponModal'));
        modal.hide();
        document.getElementById('couponForm').reset();
        document.getElementById('discountSuffix').textContent = '%';
    };
    reader.readAsDataURL(bannerFile);
});



// Add this function to handle multiple row deletion
function deleteSelectedRows() {
    const checkboxes = document.querySelectorAll('#couponsTableBody input[type="checkbox"]:checked');
    if (checkboxes.length === 0) {
        alert('Please select at least one coupon to delete');
        return;
    }

    // Show confirmation modal
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
    document.getElementById('deleteMessage').textContent = 
        `Are you sure you want to delete ${checkboxes.length} selected coupon(s)?`;
    deleteModal.show();

    // Set up confirm button handler
    document.getElementById('confirmDeleteBtn').onclick = function() {
        const coupons = loadCoupons();
        const selectedIds = Array.from(checkboxes).map(checkbox => {
            return checkbox.closest('tr').querySelector('td:nth-child(3)').textContent; // Get coupon code from 3rd column
        });

        // Filter out the selected coupons
        const updatedCoupons = coupons.filter(coupon => !selectedIds.includes(coupon.code));
        saveCoupons(updatedCoupons);
        
        // Refresh the table
        renderCoupons();
        deleteModal.hide();
        
        // Uncheck the "select all" checkbox
        document.getElementById('selectAll').checked = false;
    };
}

// Update the DOMContentLoaded event to add the click handler
document.addEventListener('DOMContentLoaded', function() {
    // ... your existing DOMContentLoaded code ...
    
    // Add click handler for delete selected button
    document.getElementById('deleteSelectedBtn').addEventListener('click', deleteSelectedRows);
    
    // Update the select all checkbox functionality
    document.getElementById('selectAll').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#couponsTableBody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });
});

// Update the renderCoupons function to include proper checkbox handling
function renderCoupons() {
    const coupons = loadCoupons();
    const tableBody = document.getElementById('couponsTableBody');
    tableBody.innerHTML = '';

    if (coupons.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="11" class="text-center py-4">No coupons found. Click "Add Coupons" to create one.</td>
            </tr>
        `;
        return;
    }

    coupons.forEach(coupon => {
        // Determine status based on dates
        const now = new Date();
        const validFrom = new Date(coupon.validFrom);
        const validUntil = new Date(coupon.validUntil);
        
        let status = 'Active';
        let statusClass = 'badge bg-success';
        
        if (now < validFrom) {
            status = 'Upcoming';
            statusClass = 'badge bg-info';
        } else if (now > validUntil) {
            status = 'Expired';
            statusClass = 'badge bg-danger';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="checkbox"></td>
            <td>
                ${coupon.banner ? 
                    `<img src="${coupon.banner}" alt="Coupon Banner" style="width: 80px; height: 30px; object-fit: cover;">` : 
                    'No Banner'}
            </td>
            <td>${coupon.code}</td>
            <td>${coupon.name}</td>
            <td>${coupon.description || '-'}</td>
            <td>${coupon.discountType === 'percentage' ? 'Percentage' : 'Fixed Amount'}</td>
            <td><span class="${statusClass}">${status}</span></td>
            <td>${formatDate(coupon.validFrom)}</td>
            <td>${formatDate(coupon.validUntil)}</td>
            <td>${coupon.discountValue}${coupon.discountType === 'percentage' ? '%' : '$'}</td>
            <td class="text-center">
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-primary" title="Edit" onclick="handleEditCoupon('${coupon.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="deleteCoupon('${coupon.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tableBody.appendChild(row);
    });
}
// Function to handle edit button click
function handleEditCoupon(couponId) {
    const coupons = loadCoupons();
    const couponToEdit = coupons.find(c => c.id === couponId);
    
    if (!couponToEdit) return;

    // Fill the modal with coupon data
    document.getElementById('couponName').value = couponToEdit.name;
    document.getElementById('couponCode').value = couponToEdit.code;
    document.getElementById('validityStart').value = couponToEdit.validFrom.slice(0, 16);
    document.getElementById('validityEnd').value = couponToEdit.validUntil.slice(0, 16);
    document.getElementById('discountType').value = couponToEdit.discountType;
    document.getElementById('discountValue').value = couponToEdit.discountValue;
    document.getElementById('couponDescription').value = couponToEdit.description || '';
    document.getElementById('discountSuffix').textContent = couponToEdit.discountType === 'percentage' ? '%' : '$';

    // Change modal title and button
    document.getElementById('addCouponModalLabel').textContent = 'Edit Coupon';
    const addBtn = document.getElementById('addCouponBtn');
    addBtn.textContent = 'Update Coupon';
    addBtn.onclick = function() {
        updateCoupon(couponId);
    };

    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('addCouponModal'));
    modal.show();
}

// Function to update coupon
function updateCoupon(couponId) {
    const bannerFile = document.getElementById('couponBanner').files[0];
    const coupons = loadCoupons();
    const couponIndex = coupons.findIndex(c => c.id === couponId);
    
    if (couponIndex === -1) return;

    if (bannerFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
            updateCouponData(couponId, couponIndex, coupons, e.target.result);
        };
        reader.readAsDataURL(bannerFile);
    } else {
        // Keep the existing banner if no new file is selected
        updateCouponData(couponId, couponIndex, coupons, coupons[couponIndex].banner);
    }
}

// Helper function to update coupon data
function updateCouponData(couponId, couponIndex, coupons, bannerData) {
    coupons[couponIndex] = {
        id: couponId,
        banner: bannerData,
        name: document.getElementById('couponName').value,
        code: document.getElementById('couponCode').value,
        validFrom: document.getElementById('validityStart').value,
        validUntil: document.getElementById('validityEnd').value,
        discountType: document.getElementById('discountType').value,
        discountValue: document.getElementById('discountValue').value,
        description: document.getElementById('couponDescription').value,
        createdAt: coupons[couponIndex].createdAt // Keep original creation date
    };

    saveCoupons(coupons);
    
    // Reset modal and refresh table
    const modal = bootstrap.Modal.getInstance(document.getElementById('addCouponModal'));
    modal.hide();
    document.getElementById('couponForm').reset();
    document.getElementById('discountSuffix').textContent = '%';
    
    // Reset modal title and button
    document.getElementById('addCouponModalLabel').textContent = 'Add New Coupon';
    const addBtn = document.getElementById('addCouponBtn');
    addBtn.textContent = 'Add Coupon';
    addBtn.onclick = function() {
        // Your existing add coupon functionality
        const bannerFile = document.getElementById('couponBanner').files[0];
        if (!bannerFile) {
            alert('Please upload a coupon banner image');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const coupons = loadCoupons();
            const newCoupon = {
                id: Date.now().toString(),
                banner: e.target.result,
                name: document.getElementById('couponName').value,
                code: document.getElementById('couponCode').value,
                validFrom: document.getElementById('validityStart').value,
                validUntil: document.getElementById('validityEnd').value,
                discountType: document.getElementById('discountType').value,
                discountValue: document.getElementById('discountValue').value,
                description: document.getElementById('couponDescription').value,
                createdAt: new Date().toISOString()
            };

            coupons.push(newCoupon);
            saveCoupons(coupons);
            renderCoupons();

            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('addCouponModal'));
            modal.hide();
            document.getElementById('couponForm').reset();
            document.getElementById('discountSuffix').textContent = '%';
        };
        reader.readAsDataURL(bannerFile);
    };
    
    renderCoupons();
}

// Left nav toggle
document.getElementById('menuIcon').addEventListener('click', function() {
    const leftNav = document.getElementById('leftNav');
    leftNav.style.display = leftNav.style.display === 'block' ? 'none' : 'block';
});

// Profile menu toggle
document.getElementById('profileIcon').addEventListener('click', function(e) {
    e.stopPropagation();
    const menu = document.getElementById('profileMenu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
});

// Close profile menu when clicking outside
document.addEventListener('click', function() {
    document.getElementById('profileMenu').style.display = 'none';
});

// Submenu toggles
document.getElementById('onlineStoreToggle').addEventListener('click', function() {
    const sub = document.getElementById('onlineStoreSub');
    sub.style.display = sub.style.display === 'block' ? 'none' : 'block';
});

document.getElementById('catalogToggle').addEventListener('click', function() {
    const sub = document.getElementById('catalogSub');
    sub.style.display = sub.style.display === 'block' ? 'none' : 'block';
});

document.getElementById('customersToggle').addEventListener('click', function() {
    const sub = document.getElementById('customersSub');
    sub.style.display = sub.style.display === 'block' ? 'none' : 'block';
});


document.addEventListener('DOMContentLoaded', function() {
    const leftNav = document.getElementById('leftNav');
    leftNav.style.display = 'block';
    
    // Initialize with sample data if localStorage is empty
    initializeSampleData();
    renderCoupons();
});


// Filter functionality
document.getElementById('filterBtn').addEventListener('click', function() {
    const searchTerm = document.querySelector('.search-box input').value.toLowerCase();
    const discountType = document.querySelector('#discountTypeDropdown + .dropdown-menu .active').textContent;
    const status = document.querySelector('#statusDropdown + .dropdown-menu .active').textContent;
    
    const rows = document.querySelectorAll('#couponsTableBody tr');
    
    rows.forEach(row => {
        const couponName = row.cells[2].textContent.toLowerCase();
        const rowDiscountType = row.cells[5].textContent;
        const rowStatus = row.cells[6].textContent;
        
        const nameMatch = searchTerm === '' || couponName.includes(searchTerm);
        const typeMatch = discountType === 'All Types' || rowDiscountType.includes(discountType);
        const statusMatch = status === 'All Statuses' || rowStatus.includes(status);
        
        row.style.display = (nameMatch && typeMatch && statusMatch) ? '' : 'none';
    });
});

// Reset functionality
document.getElementById('resetBtn').addEventListener('click', function() {
    // Reset search input
    document.querySelector('.search-box input').value = '';
    
    // Reset dropdown selections
    document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item, #statusDropdown + .dropdown-menu .dropdown-item')
        .forEach(item => item.classList.remove('active'));
    document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item:first-child, #statusDropdown + .dropdown-menu .dropdown-item:first-child')
        .forEach(item => item.classList.add('active'));
    
    // Show all rows
    document.querySelectorAll('#couponsTableBody tr').forEach(row => {
        row.style.display = '';
    });
});

// Add this script to enable all filter functionality
document.addEventListener('DOMContentLoaded', function() {
    // Initialize dropdown selections
    document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item:first-child, #statusDropdown + .dropdown-menu .dropdown-item:first-child')
        .forEach(item => item.classList.add('active'));

    // Search functionality
    const searchInput = document.querySelector('.search-box input');
    const searchButton = document.querySelector('.search-box button');
    
    function performSearch() {
        const searchTerm = searchInput.value.toLowerCase();
        const rows = document.querySelectorAll('#couponsTableBody tr');
        
        rows.forEach(row => {
            const couponCode = row.cells[2].textContent.toLowerCase();
            const couponName = row.cells[3].textContent.toLowerCase();
            const couponDesc = row.cells[4].textContent.toLowerCase();
            
            const matches = couponCode.includes(searchTerm) || 
                          couponName.includes(searchTerm) || 
                          couponDesc.includes(searchTerm);
            
            row.style.display = matches ? '' : 'none';
        });
    }
    
    searchButton.addEventListener('click', performSearch);
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    // Dropdown selection handlers
    document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item').forEach(item => {
        item.addEventListener('click', function() {
            this.parentElement.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('discountTypeDropdown').textContent = this.textContent;
        });
    });

    document.querySelectorAll('#statusDropdown + .dropdown-menu .dropdown-item').forEach(item => {
        item.addEventListener('click', function() {
            this.parentElement.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('statusDropdown').textContent = this.textContent;
        });
    });

    // Filter button functionality
    document.getElementById('filterBtn').addEventListener('click', function() {
        const searchTerm = searchInput.value.toLowerCase();
        const discountType = document.querySelector('#discountTypeDropdown + .dropdown-menu .active').textContent;
        const status = document.querySelector('#statusDropdown + .dropdown-menu .active').textContent;
        
        const rows = document.querySelectorAll('#couponsTableBody tr');
        
        rows.forEach(row => {
            const couponCode = row.cells[2].textContent.toLowerCase();
            const couponName = row.cells[3].textContent.toLowerCase();
            const couponDesc = row.cells[4].textContent.toLowerCase();
            const rowDiscountType = row.cells[5].textContent;
            const rowStatus = row.cells[6].textContent;
            
            const nameMatch = searchTerm === '' || 
                            couponCode.includes(searchTerm) || 
                            couponName.includes(searchTerm) || 
                            couponDesc.includes(searchTerm);
            const typeMatch = discountType === 'All Types' || rowDiscountType.includes(discountType);
            const statusMatch = status === 'All Statuses' || rowStatus.includes(status);
            
            row.style.display = (nameMatch && typeMatch && statusMatch) ? '' : 'none';
        });
    });

    // Reset button functionality
    document.getElementById('resetBtn').addEventListener('click', function() {
        // Reset search input
        searchInput.value = '';
        
        // Reset dropdown selections
        document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item, #statusDropdown + .dropdown-menu .dropdown-item')
            .forEach(item => item.classList.remove('active'));
        document.querySelectorAll('#discountTypeDropdown + .dropdown-menu .dropdown-item:first-child, #statusDropdown + .dropdown-menu .dropdown-item:first-child')
            .forEach(item => item.classList.add('active'));
        
        // Reset dropdown button text
        document.getElementById('discountTypeDropdown').textContent = 'Discount Type';
        document.getElementById('statusDropdown').textContent = 'Status';
        
        // Show all rows
        document.querySelectorAll('#couponsTableBody tr').forEach(row => {
            row.style.display = '';
        });
    });
});
</script>
<script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
<script>
    // Export functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Add event listeners to export dropdown items
        document.querySelectorAll('.dropdown-item').forEach(item => {
            if (item.textContent.includes('Excel')) {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    exportToExcel();
                });
            } else if (item.textContent.includes('CSV')) {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    exportToCSV();
                });
            }
        });

        function exportToExcel() {
            try {
                // Get the table element
                const table = document.querySelector('.table-container table');
                
                // Create a workbook with the table data
                const workbook = XLSX.utils.table_to_book(table, {sheet: "Coupons"});
                
                // Generate Excel file and trigger download
                XLSX.writeFile(workbook, 'coupons_export.xlsx');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                alert('Error exporting to Excel. Please try again.');
            }
        }

        function exportToCSV() {
            try {
                // Get the table element
                const table = document.querySelector('.table-container table');
                
                // Convert table to worksheet
                const worksheet = XLSX.utils.table_to_sheet(table);
                
                // Convert worksheet to CSV
                const csv = XLSX.utils.sheet_to_csv(worksheet);
                
                // Create download link
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "coupons_export.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Error exporting to CSV:', error);
                alert('Error exporting to CSV. Please try again.');
            }
        }
    });
</script>



</body>
</html>